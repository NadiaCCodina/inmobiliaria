@model IEnumerable<inmobiliaria.Models.Inmueble>

@{
	ViewData["Title"] = "Index";
	var ltaPropietario = (IList<Propietario>)ViewBag.Propietario;

	var msj = TempData["Mensaje"] as string;
	var fechaIni = ViewBag.FechaIni;
	var fechaFi = ViewBag.FechaF;


}

<h1 class="mb-4">Listado de Inmuebles</h1>

@if (!string.IsNullOrEmpty(msj))
{
	<div class="alert alert-info">@msj</div>
}

<p>
	<a asp-action="Create" class="btn btn-primary mb-3">Crear nuevo inmueble</a>
</p>

<div class="card mb-4">
	<div class="card-header bg-primary text-white">
		<strong>Filtros de búsqueda</strong>
	</div>
	<div class="card-body">
		<div class="container">
			<form class="form-row justify-content-center">
				<div class="form-group col-md-4 mx-auto">
					<label for="ambientesSelect">Ambientes</label>
					<select id="ambientesSelect" class="form-control" name="ambientes">
						<option value="">------</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
					</select>
				</div>
				<div class="form-group col-md-4 mx-auto">
					<label for="tipoSelect">Tipo</label>
					<select id="tipoSelect" class="form-control" name="tipo">
						<option value="">------</option>
						<option value="Departamento">Departamento</option>
						<option value="Casa">Casa</option>
						<option value="Local">Local</option>
						<option value="Galpon">Galpon</option>
					</select>
				</div>
				<div class="form-group col-md-4 mx-auto">
					<label for="propietarioSelect">Propietario</label>
					<select id="propietarioSelect" class="form-control" name="propietarioId">
						<option value="">------</option>
						@foreach (var item in ltaPropietario)
						{
							<option value="@item.Id">@item.ToString()</option>
						}
					</select>
				</div>
				<div class="form-group col-md-4 mx-auto">
					<button type="button" class="btn btn-outline-primary w-100 mt-3"
						onclick="buscarPor()">Buscar</button>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="card mb-4">
	<div class="card-header bg-primary text-white">
		<strong>Filtros por Fecha de Contrato</strong>
	</div>
	<div class="card-body">
		<form class="row justify-content-center">
			<div class="col-md-4">
				<div class="form-group">
					<label for="fechaInicioSelect">Fecha Inicio</label>
					<input id="fechaInicioSelect" type="date" class="form-control" />
				</div>

				<div class="form-group">
					<label for="fechaFinSelect" class="mt-3">Fecha Fin</label>
					<input id="fechaFinSelect" type="date" class="form-control" />
				</div>

				<button type="button" class="btn btn-outline-primary w-100 mt-3" onclick="buscarPorFecha()">
					Buscar por Fechas
				</button>
			</div>
		</form>
	</div>

</div>


<div class="table-responsive">
	<table class="table table-striped table-bordered table-hover">
		<thead class="thead-light">
			<tr>
				<th>@Html.DisplayNameFor(model => model.Id)</th>
				<th>@Html.DisplayNameFor(model => model.Direccion)</th>
				<th>@Html.DisplayNameFor(model => model.Ambientes)</th>
				<th>@Html.DisplayNameFor(model => model.Superficie)</th>
				<th>@Html.DisplayNameFor(model => model.Latitud)</th>
				<th>@Html.DisplayNameFor(model => model.Longitud)</th>
				<th>@Html.DisplayNameFor(model => model.Uso)</th>
				<th>@Html.DisplayNameFor(model => model.Tipo)</th>
				<th>@Html.DisplayNameFor(model => model.Precio)</th>
				<th>@Html.DisplayNameFor(model => model.PropietarioId)</th>
				<th>Fecha</th>
				<th>Último Contrato</th>
				<th>Acciones</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model)
			{
				<tr>
					<td>@Html.DisplayFor(modelItem => item.Id)</td>
					<td>@Html.DisplayFor(modelItem => item.Direccion)</td>
					<td>@Html.DisplayFor(modelItem => item.Ambientes)</td>
					<td>@Html.DisplayFor(modelItem => item.Superficie)</td>
					<td>@Html.DisplayFor(modelItem => item.Latitud)</td>
					<td>@Html.DisplayFor(modelItem => item.Longitud)</td>
					<td>@Html.DisplayFor(modelItem => item.Uso)</td>
					<td>@Html.DisplayFor(modelItem => item.Tipo)</td>
					<td>@Html.DisplayFor(modelItem => item.Precio)</td>
					<td>@(item.Duenio != null ? item.Duenio.ToString() : "Sin dueño")</td>
					<td>@(item.ContratoInmueble?.FechaInicio != null ? item.ContratoInmueble.FechaInicio.ToString("yyyy-MM-dd") : "-")</td>
				    <td>@(item.ContratoInmueble?.FechaFin != null ? item.ContratoInmueble.FechaFin.ToString("yyyy-MM-dd") :
										"-")</td>

				<td>
					<a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-primary mb-1">Editar</a>
					<a asp-action="Eliminar" asp-route-id="@item.Id" class="btn btn-sm btn-danger mb-1">Eliminar</a>
					<a asp-action="Create" asp-controller="Contrato" asp-route-id="@item.Id"
						asp-route-fechaInicio="@(fechaIni != null ? fechaIni.ToString("yyyy-MM-dd") : "")"
						asp-route-fechaFin="@(fechaFi != null ? fechaFi.ToString("yyyy-MM-dd") : "")"
						class="btn btn-sm btn-success mb-1">Crear contrato</a>
				</td>
			</tr>
						}
		</tbody>
	</table>
</div>

@section Scripts {
	<script>
		function buscarPorPropietario() {
			var propietarioId = document.getElementById('propietarioSelect').value;
			if (propietarioId) {
				window.location.href = '/Inmueble/porPropietario/' + propietarioId;
			}
		}
		function buscarPorFecha() {
			var fechaI = document.getElementById('fechaInicioSelect').value;
			var fechaF = document.getElementById('fechaFinSelect').value;

			if (fechaI && fechaF) {
				window.location.href = '/Inmueble/porFechaContrato?fechaInicio=' + encodeURIComponent(fechaI) + '&fechaFin=' + encodeURIComponent(fechaF);
			}
		}
		function buscarPorAmbientes() {
			var ambientes = document.getElementById('ambientesSelect').value;
			if (ambientes) {
				window.location.href = '/Inmueble/porAmbiente?cantidad=' + ambientes;
			}
		}

		function buscarPorTipo() {
			var tipo = document.getElementById('tipoSelect').value;
			if (tipo) {
				window.location.href = '/Inmueble/porTipo?tipo=' + tipo;
			}
		}

		function buscarPor() {
			var propietarioId = document.getElementById('propietarioSelect').value;
			var ambientes = document.getElementById('ambientesSelect').value;
			var tipo = document.getElementById('tipoSelect').value;



			window.location.href = '/Inmueble/buscarPor?tipo=' + tipo + "&cantidad=" + ambientes + "&propietarioId=" + propietarioId

		}

	</script>


}